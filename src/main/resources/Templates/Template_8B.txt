#TEMPLATE 8B
SELECT ?ticker ?resultadoFinal WHERE {
    ?SO1 P8 ?ticker .
    ?SO1 P3 ?negociadoNode .
    ?negociadoNode P5 ?S2 .
    ?S2 P6 "#DATA#"^^xsd:date .
    ?negociadoNode b3:precoMaximo ?maximo .
    ?negociadoNode b3:precoMinimo ?minimo .
    ?negociadoNode b3:precoAbertura ?abertura .
    ?negociadoNode b3:precoFechamento ?fechamento .
    FILTER(?abertura > 0)
    BIND((#CALCULO#) AS ?resultadoFinal)
    {
        SELECT ?SO1 WHERE {
            #FILTER_BLOCK_SETOR#
            ?S1 P1 ?SO1 .
            ?SO1 P3 ?negociadoNode_rank .
            ?negociadoNode_rank P5 ?S2_rank .
            ?S2_rank P6 "#DATA#"^^xsd:date .
            ?negociadoNode_rank b3:precoAbertura ?abertura_rank .
            ?negociadoNode_rank b3:precoFechamento ?fechamento_rank .
            ?negociadoNode_rank b3:precoMaximo ?maximo_rank .
            ?negociadoNode_rank b3:precoMinimo ?minimo_rank .
            FILTER(?abertura_rank > 0)
            BIND((#RANKING_CALCULATION#) AS ?rankingValue) 
        }
        ORDER BY #ORDEM#(?rankingValue)
        LIMIT 1
    }
}
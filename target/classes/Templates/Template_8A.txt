#TEMPLATE 8A
SELECT ?ticker ?resultadoFinal WHERE {
    ?SO1 P8 ?ticker .
    ?SO1 P3 ?negociadoNode .
    ?negociadoNode P5 ?S2 .
    ?S2 P6 "#DATA#"^^xsd:date .
    ?negociadoNode b3:precoMaximo ?maximo .
    ?negociadoNode b3:precoMinimo ?minimo .
    ?negociadoNode b3:precoAbertura ?abertura .
    ?negociadoNode b3:precoFechamento ?fechamento .
    BIND((#CALCULO#) AS ?resultadoFinal)
    {
        SELECT ?SO1 WHERE {
            ?SO1 P3 ?negociadoNode_rank .
            ?negociadoNode_rank P5 ?S2_rank .
            ?S2_rank P6 "#DATA#"^^xsd:date .
            ?negociadoNode_rank b3:precoAbertura ?abertura_rank .
            ?negociadoNode_rank b3:precoFechamento ?fechamento_rank .
            FILTER(?abertura_rank > 0)
            BIND((((?fechamento_rank - ?abertura_rank) / ?abertura_rank) * 100) AS ?rankingValue)
        }
        ORDER BY #ORDEM#(?rankingValue)
        LIMIT 1
    }
}